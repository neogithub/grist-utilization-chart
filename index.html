<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Grist Test</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
</head>
<body>
    <h1>Grist Connection Test</h1>
    <div id="status"></div>
    <div id="data"></div>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerHTML += "<br>" + new Date().toISOString() + ": " + message;
        }

        updateStatus("Page loaded");

        // Correct way to use grist.ready()
        grist.ready();
        updateStatus("Called grist.ready()");

        // Set up record handling
        grist.onRecords(function(records) {
            updateStatus("Received " + records.length + " records");
            
            // Display the data we're getting
            const dataDiv = document.getElementById('data');
            if (records && records.length > 0) {
                dataDiv.innerHTML = "<h3>First Record Data:</h3>" +
                    "<pre>" + JSON.stringify(records[0], null, 2) + "</pre>";
                
                // Log the structure
                updateStatus("Record structure: " + Object.keys(records[0]).join(", "));
            } else {
                dataDiv.innerHTML = "<p>No records received</p>";
            }
        });

        // Add error handler
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            updateStatus("ERROR: " + msg);
            return false;
        };
    </script>
</body>
</html>