<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Grist Test</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
</head>
<body>
    <h1>Grist Connection Test</h1>
    <div id="status"></div>

    <script>
        // Update status function
        function updateStatus(message) {
            document.getElementById('status').innerHTML += "<br>" + new Date().toISOString() + ": " + message;
        }

        // Initial status
        updateStatus("Page loaded");

        // Check if grist is defined
        if (typeof grist !== 'undefined') {
            updateStatus("Grist API found");
        } else {
            updateStatus("ERROR: Grist API not found!");
        }

        // Try to connect to Grist
        try {
            grist.ready({
                requiredAccess: 'read'
            }).then(() => {
                updateStatus("Grist connection successful");
                
                // Try to get records
                grist.onRecords(records => {
                    updateStatus("Got records: " + records.length);
                    if (records.length > 0) {
                        updateStatus("First record: " + JSON.stringify(records[0]));
                    }
                });
            }).catch(err => {
                updateStatus("ERROR connecting to Grist: " + err.message);
            });
        } catch (err) {
            updateStatus("ERROR initializing Grist: " + err.message);
        }

        // Add error handler
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            updateStatus("ERROR: " + msg);
            return false;
        };
    </script>
</body>
</html>